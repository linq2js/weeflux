{"version":3,"sources":["../index.js"],"names":["subscribe","clean","middleware","args","arguments","length","getState","Function","dispatch","reducer","init","connect","hoc","defaultState","currentState","subscribers","reducers","actionQueue","middlewares","hocs","intialState","Error","configure","component","reduce","wrappedComponent","props","wrapper","hasParam","map","prop","undefined","subscriber","customArgs","originalSubscriber","push","unsubscribed","index","indexOf","splice","callReducer","debounce","lastState","queue","slice","resolves","forEach","reduceContext","resolve","next","context","state","result","action","payload","Promise","value","interval","func","timerId","clearTimeout","setTimeout","split"],"mappings":"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","file":"index.js","sourcesContent":["const defaultState = {};\r\nlet currentState = defaultState;\r\nconst subscribers = [];\r\nconst reducers = [];\r\nconst actionQueue = [];\r\nconst middlewares = [];\r\nconst hocs = [];\r\n\r\nfunction init(intialState) {\r\n  if (currentState !== defaultState) {\r\n    throw new Error('State is already changed');\r\n  }\r\n  currentState = intialState;\r\n}\r\n\r\nfunction connect(configure = {}, component) {\r\n  if (!hocs.length) return component;\r\n  return hocs.reduce((wrappedComponent, { props, wrapper }) => {\r\n    let hasParam = false;\r\n    const args = props.map(prop => {\r\n      if (prop in configure) {\r\n        hasParam = true;\r\n        return configure[prop];\r\n      }\r\n      return undefined;\r\n    });\r\n\r\n    if (!hasParam) return wrappedComponent;\r\n    return wrapper(...args)(wrappedComponent);\r\n  }, component);\r\n}\r\n\r\nexport function subscribe(subscriber, ...customArgs) {\r\n  if (customArgs.length) {\r\n    const originalSubscriber = subscriber;\r\n    subscriber = function(...args) {\r\n      originalSubscriber(...customArgs, ...args);\r\n    };\r\n  }\r\n  subscribers.push(subscriber);\r\n  let unsubscribed = false;\r\n  return function() {\r\n    if (unsubscribed) return;\r\n    unsubscribed = true;\r\n    const index = subscribers.indexOf(subscriber);\r\n    if (index !== -1) {\r\n      subscribers.splice(index, 1);\r\n    }\r\n  };\r\n}\r\n\r\nconst callReducer = debounce(0, function() {\r\n  let lastState = currentState;\r\n  const queue = actionQueue.slice();\r\n  const resolves = [];\r\n  actionQueue.length = 0;\r\n  queue.forEach(reduceContext => {\r\n    resolves.push(reduceContext.resolve);\r\n    function next(context) {\r\n      return reducers.reduce((state, reducer) => {\r\n        const result = reducer(state, context);\r\n        if (result === undefined) return state;\r\n        return result;\r\n      }, context.getState());\r\n    }\r\n\r\n    currentState = middlewares.reduce(\r\n      (next, middleware) => (...args) => middleware(next)(...args),\r\n      next\r\n    )({\r\n      ...reduceContext,\r\n      getState\r\n    });\r\n  });\r\n  resolves.forEach(resolve => resolve());\r\n  if (lastState !== currentState) {\r\n    subscribers.forEach(subscriber => subscriber(currentState));\r\n  }\r\n});\r\n\r\nfunction getState() {\r\n  return currentState;\r\n}\r\n\r\nfunction dispatch(action, payload) {\r\n  return new Promise(resolve => {\r\n    actionQueue.push({ action, payload, resolve });\r\n    callReducer();\r\n  });\r\n}\r\n\r\nfunction reducer(value) {\r\n  reducers.push(value);\r\n}\r\n\r\nfunction debounce(interval, func) {\r\n  let timerId;\r\n  return function(...args) {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(func, interval, ...args);\r\n  };\r\n}\r\n\r\nexport function clean() {\r\n  subscribers.length = 0;\r\n  reducers.length = 0;\r\n  actionQueue.length = 0;\r\n  middlewares.length = 0;\r\n  hocs.length = 0;\r\n  currentState = defaultState;\r\n}\r\n\r\nexport function middleware(...values) {\r\n  middlewares.push(...values);\r\n}\r\n\r\nexport default function(...args) {\r\n  if (!arguments.length) {\r\n    //flux();\r\n    return getState();\r\n  }\r\n\r\n  if (\r\n    !(args[1] instanceof Function) &&\r\n    (typeof args[0] === 'string' || typeof args[0] === 'number')\r\n  ) {\r\n    return dispatch(...args);\r\n  }\r\n\r\n  if (args.length === 1) {\r\n    if (args[0] instanceof Function) {\r\n      // flux(subscriber);\r\n      return reducer(args[0]);\r\n    }\r\n\r\n    return init(args[0]);\r\n  }\r\n  return connect(...args);\r\n}\r\n\r\nexport function hoc(props, wrapper) {\r\n  hocs.push({ props: props.split(/\\s+/), wrapper });\r\n}\r\n"]}